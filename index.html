<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
	<title>Leaflet.draw vector editing handlers</title>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />

	<!-- Leaflet kernel -->
	<link rel="icon" type="image/png" href="http://leafletjs.com/docs/images/favicon.ico" />
	<link type="text/css" rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
	<script type="text/javascript" src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>

	<!-- Draw pluggin -->
	<link type="text/css" rel="stylesheet" href="http://leaflet.github.io/Leaflet.draw/lib/leaflet/leaflet.css" />
	<script type="text/javascript" src="http://leaflet.github.io/Leaflet.draw/leaflet.draw.js"></script>
	<script type="text/javascript" src="../../Leaflet/Leaflet.draw/dist/leaflet.draw-src.js"></script>
	
	<--script type="text/javascript" src="../../mapbox/togeojson/togeojson.js"></script>
	<--script type="text/javascript" src="../../erictheise/rrose/leaflet.rrose-src.js"></script>

	<!-- Snap pluggin -->
	<script type="text/javascript" src="http://makinacorpus.github.io/Leaflet.Snap/Leaflet.GeometryUtil/dist/leaflet.geometryutil.js"></script>
	<script type="text/javascript" src="../../makinacorpus/Leaflet.Snap/leaflet.snap.js"></script>

	<!-- This pluggin -->
	<script type="text/javascript" src="Edit.Poly.cut.js"></script>
	<script type="text/javascript" src="EditToolbar.SwitchPoly.js"></script>
	<script type="text/javascript" src="Control.Draw.Plus.js"></script>
</head>

<body>
	<div id="carte" style="width: 800px; height: 600px"></div>
	<textarea id="entree" rows="20" cols="120">
{"type":"FeatureCollection","features":[{"type":"Feature","properties":{},"geometry":{"type":"LineString","coordinates":[[2.581787109375,46.22545288226939],[2.713623046875,45.1510532655634],[4.185791015625,44.972570682240644],[4.866943359375,45.805828539928356]]}},{"type":"Feature","properties":{},"geometry":{"type":"Point","coordinates":[3.1640625,45.336701909968106]}}]}
	</textarea>
	<div id="change" style="display:none"><i>Changé</i></div>

	<script>
window.addEventListener('load', function() {
	var carte = L.map('carte').setView([45, 5], 7);

	L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
		attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a>; contributors'
	}).addTo(carte);

//------------------------ EDIT -----------------------------------

	var editeur = new L.Control.Draw.Plus({
		draw: {
			marker: true,
			polyline: true,
			polygon: true,
//			rectangle: true,
//			circle: true
		},
		edit: {
//			edit: true,
			switchpoly: true
		}
	}).addTo(carte);

	// Initialisation des couches éditables avec le contenu du champ en entrée
	var ljs = new L.GeoJSON(JSON.parse(document.getElementById('entree').innerHTML));
	for (var l in ljs._layers)
		carte.fire('draw:created', {
			layer: ljs._layers[l]
		});

	// Restitution des couches éditables dans le champ en sortie
	carte.on('draw:edited', function() {
		document.getElementById('entree').innerHTML = JSON.stringify(editeur.editLayers.toGeoJSON());
		document.getElementById('change').style.display = '';
	});
});
	</script>
</body>
</html>
